<!-- templates/dashboard.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>body{background:#000;color:#fff;font-family:Inter,system-ui,-apple-system}</style>
</head>
<body class="min-h-screen p-4">
  <div class="max-w-6xl mx-auto">
    <div class="flex items-center justify-between mb-4">
      <h1 class="text-2xl font-bold">Admin Dashboard â€” ADE</h1>
      <div class="flex gap-2">
        <a href="/" class="px-3 py-2 border border-neutral-800 rounded">View site</a>
        <a href="/logout" class="px-3 py-2 bg-red-700 rounded">Logout</a>
      </div>
    </div>

    <div class="bg-neutral-900 border border-neutral-800 rounded p-4 space-y-6">

      <div class="flex gap-2 mb-3">
        <button class="tab-btn px-3 py-2 rounded bg-blue-600" data-tab="tt">Timetable</button>
        <button class="tab-btn px-3 py-2 rounded bg-neutral-800" data-tab="ex">Exams</button>
        <button class="tab-btn px-3 py-2 rounded bg-neutral-800" data-tab="co">Courses</button>
        <button class="tab-btn px-3 py-2 rounded bg-neutral-800" data-tab="se">Seating</button>
      </div>

      <!-- Timetable -->
      <div id="tt" class="tab-panel">
        <div class="flex gap-2 mb-3 items-center">
          <select id="tt-sem" class="px-3 py-2 bg-neutral-800 rounded">
            <option value="">Semester</option>
            <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option>
          </select>
          <select id="tt-day" class="px-3 py-2 bg-neutral-800 rounded">
            <option value="">Day</option><option>Monday</option><option>Tuesday</option><option>Wednesday</option><option>Thursday</option><option>Friday</option><option>Saturday</option><option>Sunday</option>
          </select>
          <input id="tt-time" placeholder="Time (e.g. 8:55 AM - 9:55 AM)" class="px-3 py-2 bg-neutral-800 rounded flex-1"/>
          <input id="tt-sub" placeholder="Subject" class="px-3 py-2 bg-neutral-800 rounded" />
          <input id="tt-room" placeholder="Room" class="px-3 py-2 bg-neutral-800 rounded" />
          <button id="tt-add" class="bg-green-600 px-3 py-2 rounded">Add</button>
          <button id="tt-update" class="bg-yellow-500 px-3 py-2 rounded">Update</button>
        </div>
        <div class="mb-2">
          <button id="tt-refresh" class="px-3 py-2 bg-blue-600 rounded">Refresh</button>
          <button id="tt-delete" class="px-3 py-2 bg-red-700 rounded">Delete Selected</button>
        </div>
        <div id="tt-list" class="max-h-64 overflow-auto border border-neutral-800 rounded p-2"></div>
      </div>

      <!-- Exams -->
      <div id="ex" class="tab-panel hidden">
        <div class="flex gap-2 mb-3 items-center">
          <select id="ex-sem" class="px-3 py-2 bg-neutral-800 rounded">
            <option value="">Semester</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option>
          </select>
          <input id="ex-sub" placeholder="Subject" class="px-3 py-2 bg-neutral-800 rounded" />
          <input id="ex-date" placeholder="YYYY-MM-DD" class="px-3 py-2 bg-neutral-800 rounded" />
          <input id="ex-time" placeholder="Time" class="px-3 py-2 bg-neutral-800 rounded" />
          <input id="ex-room" placeholder="Room" class="px-3 py-2 bg-neutral-800 rounded" />
          <button id="ex-add" class="bg-green-600 px-3 py-2 rounded">Add</button>
          <button id="ex-update" class="bg-yellow-500 px-3 py-2 rounded">Update</button>
        </div>
        <div class="mb-2">
          <button id="ex-refresh" class="px-3 py-2 bg-blue-600 rounded">Refresh</button>
          <button id="ex-delete" class="px-3 py-2 bg-red-700 rounded">Delete Selected</button>
        </div>
        <div id="ex-list" class="max-h-64 overflow-auto border border-neutral-800 rounded p-2"></div>
      </div>

      <!-- Courses -->
      <div id="co" class="tab-panel hidden">
        <div class="flex gap-2 mb-3 items-center">
          <select id="co-sem" class="px-3 py-2 bg-neutral-800 rounded">
            <option value="">Semester</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option>
          </select>
          <input id="co-name" placeholder="Course name" class="px-3 py-2 bg-neutral-800 rounded flex-1" />
          <input id="co-duration" placeholder="Duration" class="px-3 py-2 bg-neutral-800 rounded" />
          <input id="co-fee" placeholder="Fee" class="px-3 py-2 bg-neutral-800 rounded" />
          <button id="co-add" class="bg-green-600 px-3 py-2 rounded">Add</button>
          <button id="co-update" class="bg-yellow-500 px-3 py-2 rounded">Update</button>
        </div>
        <div class="mb-2">
          <button id="co-refresh" class="px-3 py-2 bg-blue-600 rounded">Refresh</button>
          <button id="co-delete" class="px-3 py-2 bg-red-700 rounded">Delete Selected</button>
        </div>
        <div id="co-list" class="max-h-64 overflow-auto border border-neutral-800 rounded p-2"></div>
      </div>

      <!-- Seating -->
      <div id="se" class="tab-panel hidden">
        <div class="flex gap-2 mb-3 items-center">
          <select id="se-sem" class="px-3 py-2 bg-neutral-800 rounded">
            <option value="">Semester</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option>
          </select>
          <input id="se-sub" placeholder="Subject" class="px-3 py-2 bg-neutral-800 rounded" />
          <input id="se-stu" placeholder="Student name" class="px-3 py-2 bg-neutral-800 rounded" />
          <input id="se-usn" placeholder="USN" class="px-3 py-2 bg-neutral-800 rounded" />
          <input id="se-room" placeholder="Room" class="px-3 py-2 bg-neutral-800 rounded" />
          <input id="se-seat" placeholder="Seat no." class="px-3 py-2 bg-neutral-800 rounded" />
          <button id="se-add" class="bg-green-600 px-3 py-2 rounded">Add</button>
          <button id="se-update" class="bg-yellow-500 px-3 py-2 rounded">Update</button>
        </div>
        <div class="mb-2">
          <button id="se-refresh" class="px-3 py-2 bg-blue-600 rounded">Refresh</button>
          <button id="se-delete" class="px-3 py-2 bg-red-700 rounded">Delete Selected</button>
        </div>
        <div id="se-list" class="max-h-96 overflow-auto border border-neutral-800 rounded p-2"></div>
      </div>

    </div>
  </div>

<script>
  // Tabs
  document.querySelectorAll('.tab-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.tab-btn').forEach(b=>{ b.classList.remove('bg-blue-600'); b.classList.add('bg-neutral-800'); });
      btn.classList.remove('bg-neutral-800'); btn.classList.add('bg-blue-600');
      const which = btn.dataset.tab;
      document.querySelectorAll('.tab-panel').forEach(p=>p.classList.add('hidden'));
      document.getElementById(which).classList.remove('hidden');
    });
  });

  // small helper
  async function post(url, body){ const res = await fetch(url, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)}); return res.json(); }

  // TIMETABLE
  let tt_selected = null;
  document.getElementById('tt-add').addEventListener('click', async ()=>{
    const semester = document.getElementById('tt-sem').value;
    const day = document.getElementById('tt-day').value;
    const time_range = document.getElementById('tt-time').value.trim();
    const subject = document.getElementById('tt-sub').value.trim();
    const classroom = document.getElementById('tt-room').value.trim();
    if(!semester||!day||!time_range||!subject||!classroom){ alert('All fields required'); return; }
    await post('/admin/timetable/add', {semester, day, time_range, subject, classroom});
    refresh_tt();
  });
  document.getElementById('tt-refresh').addEventListener('click', refresh_tt);

  async function refresh_tt(){
    const sem = document.getElementById('tt-sem').value;
    const list = document.getElementById('tt-list');
    if(!sem){ list.innerHTML='<div class="p-2 text-gray-400">Select semester</div>'; return; }
    const res = await fetch(`/admin/timetable/list?semester=${encodeURIComponent(sem)}`);
    const rows = await res.json();
    if(!rows.length){ list.innerHTML='<div class="p-2 text-gray-400">No rows</div>'; return; }
    let html = '<table class="w-full text-sm"><thead><tr><th></th><th>Day</th><th>Time</th><th>Subject</th><th>Room</th></tr></thead><tbody>';
    rows.forEach(r=> html += `<tr onclick="tt_load(${r.id})"><td><input class="chk" data-id="${r.id}" type="checkbox"></td><td>${r.day}</td><td>${r.time_range}</td><td>${r.subject}</td><td>${r.classroom}</td></tr>`);
    html += '</tbody></table>'; list.innerHTML = html;
  }
  window.tt_load = async function(id){
    const sem = document.getElementById('tt-sem').value;
    const res = await fetch(`/admin/timetable/list?semester=${encodeURIComponent(sem)}`); const rows = await res.json();
    const r = rows.find(x=>x.id==id); if(!r) return;
    tt_selected = r.id; document.getElementById('tt-day').value=r.day; document.getElementById('tt-time').value=r.time_range; document.getElementById('tt-sub').value=r.subject; document.getElementById('tt-room').value=r.classroom;
  }
  document.getElementById('tt-update').addEventListener('click', async ()=>{ if(!tt_selected){ alert('Select row'); return; } const semester=document.getElementById('tt-sem').value; const day=document.getElementById('tt-day').value; const time_range=document.getElementById('tt-time').value; const subject=document.getElementById('tt-sub').value; const classroom=document.getElementById('tt-room').value; await post('/admin/timetable/update',{id:tt_selected, semester, day, time_range, subject, classroom}); refresh_tt(); });
  document.getElementById('tt-delete').addEventListener('click', async ()=>{ const checks = Array.from(document.querySelectorAll('#tt-list .chk')).filter(c=>c.checked); if(!checks.length){ alert('Select rows'); return; } if(!confirm('Delete selected?')) return; for(const c of checks){ await post('/admin/timetable/delete',{id:c.dataset.id}); } refresh_tt(); });

  // EXAMS
  let ex_selected = null;
  document.getElementById('ex-add').addEventListener('click', async ()=>{ const semester=document.getElementById('ex-sem').value; const subject=document.getElementById('ex-sub').value; const date=document.getElementById('ex-date').value; const time=document.getElementById('ex-time').value; const room=document.getElementById('ex-room').value; if(!semester||!subject||!date||!time||!room){ alert('All fields required'); return;} await post('/admin/exams/add',{semester, subject, date, time, classroom:room}); refresh_ex(); });
  document.getElementById('ex-refresh').addEventListener('click', refresh_ex);
  async function refresh_ex(){ const sem=document.getElementById('ex-sem').value; const list=document.getElementById('ex-list'); if(!sem){ list.innerHTML='<div class="p-2 text-gray-400">Select semester</div>'; return; } const res=await fetch(`/admin/exams/list?semester=${encodeURIComponent(sem)}`); const rows=await res.json(); if(!rows.length){ list.innerHTML='<div class="p-2 text-gray-400">No rows</div>'; return; } let html='<table class="w-full text-sm"><thead><tr><th></th><th>Subject</th><th>Date</th><th>Time</th><th>Room</th></tr></thead><tbody>'; rows.forEach(r=> html+=`<tr onclick="ex_load(${r.id})"><td><input class="chk" data-id="${r.id}" type="checkbox"></td><td>${r.subject}</td><td>${r.date}</td><td>${r.time}</td><td>${r.classroom}</td></tr>`); html+='</tbody></table>'; list.innerHTML=html; }
  window.ex_load = async function(id){ const sem=document.getElementById('ex-sem').value; const res=await fetch(`/admin/exams/list?semester=${encodeURIComponent(sem)}`); const rows=await res.json(); const r=rows.find(x=>x.id==id); if(!r) return; ex_selected=r.id; document.getElementById('ex-sub').value=r.subject; document.getElementById('ex-date').value=r.date; document.getElementById('ex-time').value=r.time; document.getElementById('ex-room').value=r.classroom; }
  document.getElementById('ex-update').addEventListener('click', async ()=>{ if(!ex_selected){ alert('Select row'); return; } const semester=document.getElementById('ex-sem').value; const subject=document.getElementById('ex-sub').value; const date=document.getElementById('ex-date').value; const time=document.getElementById('ex-time').value; const classroom=document.getElementById('ex-room').value; await post('/admin/exams/update',{id:ex_selected, semester, subject, date, time, classroom}); refresh_ex(); });
  document.getElementById('ex-delete').addEventListener('click', async ()=>{ const checks=Array.from(document.querySelectorAll('#ex-list .chk')).filter(c=>c.checked); if(!checks.length){ alert('Select rows'); return; } if(!confirm('Delete selected?')) return; for(const c of checks){ await post('/admin/exams/delete',{id:c.dataset.id}); } refresh_ex(); });

  // COURSES
  let co_selected=null;
  document.getElementById('co-add').addEventListener('click', async ()=>{ const semester=document.getElementById('co-sem').value; const name=document.getElementById('co-name').value; const dur=document.getElementById('co-duration').value; const fee=document.getElementById('co-fee').value; if(!semester||!name){ alert('Semester and course required'); return; } await post('/admin/courses/add',{semester, course_name:name, duration:dur, fee}); refresh_co(); });
  document.getElementById('co-refresh').addEventListener('click', refresh_co);
  async function refresh_co(){ const sem=document.getElementById('co-sem').value; const list=document.getElementById('co-list'); if(!sem){ list.innerHTML='<div class="p-2 text-gray-400">Select semester</div>'; return; } const res=await fetch(`/admin/courses/list?semester=${encodeURIComponent(sem)}`); const rows=await res.json(); if(!rows.length){ list.innerHTML='<div class="p-2 text-gray-400">No rows</div>'; return; } let html='<table class="w-full text-sm"><thead><tr><th></th><th>Course</th><th>Duration</th><th>Fee</th></tr></thead><tbody>'; rows.forEach(r=> html+=`<tr onclick="co_load(${r.id})"><td><input class="chk" data-id="${r.id}" type="checkbox"></td><td>${r.course_name}</td><td>${r.duration}</td><td>${r.fee}</td></tr>`); html+='</tbody></table>'; list.innerHTML=html; }
  window.co_load = async function(id){ const sem=document.getElementById('co-sem').value; const res=await fetch(`/admin/courses/list?semester=${encodeURIComponent(sem)}`); const rows=await res.json(); const r=rows.find(x=>x.id==id); if(!r) return; co_selected=r.id; document.getElementById('co-name').value=r.course_name; document.getElementById('co-duration').value=r.duration; document.getElementById('co-fee').value=r.fee; }
  document.getElementById('co-update').addEventListener('click', async ()=>{ if(!co_selected){ alert('Select row'); return; } const semester=document.getElementById('co-sem').value; const course_name=document.getElementById('co-name').value; const duration=document.getElementById('co-duration').value; const fee=document.getElementById('co-fee').value; await post('/admin/courses/update',{id:co_selected, semester, course_name, duration, fee}); refresh_co(); });
  document.getElementById('co-delete').addEventListener('click', async ()=>{ const checks=Array.from(document.querySelectorAll('#co-list .chk')).filter(c=>c.checked); if(!checks.length){ alert('Select rows'); return; } if(!confirm('Delete selected?')) return; for(const c of checks){ await post('/admin/courses/delete',{id:c.dataset.id}); } refresh_co(); });

  // SEATING
  let se_selected=null;
  document.getElementById('se-add').addEventListener('click', async ()=>{ const semester=document.getElementById('se-sem').value; const subject=document.getElementById('se-sub').value; const student=document.getElementById('se-stu').value; const usn=document.getElementById('se-usn').value; const room=document.getElementById('se-room').value; const seat=document.getElementById('se-seat').value; if(!semester||!subject||!student||!usn||!room||!seat){ alert('All fields required'); return; } await post('/admin/seating/add',{semester, subject, student_name:student, usn, classroom:room, seat_number:seat}); refresh_se(); });
  document.getElementById('se-refresh').addEventListener('click', refresh_se);
  async function refresh_se(){ const sem=document.getElementById('se-sem').value; const list=document.getElementById('se-list'); if(!sem){ list.innerHTML='<div class="p-2 text-gray-400">Select semester</div>'; return; } const res=await fetch(`/admin/seating/list?semester=${encodeURIComponent(sem)}`); const rows=await res.json(); if(!rows.length){ list.innerHTML='<div class="p-2 text-gray-400">No rows</div>'; return; } let html='<table class="w-full text-sm"><thead><tr><th></th><th>Subject</th><th>Student</th><th>USN</th><th>Room</th><th>Seat</th></tr></thead><tbody>'; rows.forEach(r=> html+=`<tr onclick="se_load(${r.id})"><td><input class="chk" data-id="${r.id}" type="checkbox"></td><td>${r.subject}</td><td>${r.student_name}</td><td>${r.usn}</td><td>${r.classroom}</td><td>${r.seat_number}</td></tr>`); html+='</tbody></table>'; list.innerHTML=html; }
  window.se_load = async function(id){ const sem=document.getElementById('se-sem').value; const res=await fetch(`/admin/seating/list?semester=${encodeURIComponent(sem)}`); const rows=await res.json(); const r=rows.find(x=>x.id==id); if(!r) return; se_selected=r.id; document.getElementById('se-sub').value=r.subject; document.getElementById('se-stu').value=r.student_name; document.getElementById('se-usn').value=r.usn; document.getElementById('se-room').value=r.classroom; document.getElementById('se-seat').value=r.seat_number; }
  document.getElementById('se-update').addEventListener('click', async ()=>{ if(!se_selected){ alert('Select row'); return; } const semester=document.getElementById('se-sem').value; const subject=document.getElementById('se-sub').value; const student=document.getElementById('se-stu').value; const usn=document.getElementById('se-usn').value; const classroom=document.getElementById('se-room').value; const seat=document.getElementById('se-seat').value; await post('/admin/seating/update',{id:se_selected, semester, subject, student_name:student, usn, classroom, seat_number:seat}); refresh_se(); });
  document.getElementById('se-delete').addEventListener('click', async ()=>{ const checks=Array.from(document.querySelectorAll('#se-list .chk')).filter(c=>c.checked); if(!checks.length){ alert('Select rows'); return; } if(!confirm('Delete selected?')) return; for(const c of checks){ await post('/admin/seating/delete',{id:c.dataset.id}); } refresh_se(); });

  // initial
  document.querySelectorAll('.tab-btn')[0].click();
</script>
</body>
</html>
