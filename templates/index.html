<!-- templates/index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ADE Info Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background:#93bdd5; color:#000000; font-family:Inter, system-ui, -apple-system; }
    .panel { background:#fdfdfd; border:3px solid #222; border-radius:12px; }
    .bubble { animation: fadeIn .18s ease; }
    @keyframes fadeIn { from {opacity:0; transform: translateY(6px);} to {opacity:1; transform:none;} }
    table th { background:#5e2e2e; }
    table td, table th { padding:10px; }
  </style>
</head>
<body class="min-h-screen p-4 flex flex-col items-center">

  <header class="w-full max-w-4xl mb-4 flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold">ADE Info Assistant</h1>
      <p class="text-sm text-gray-400" style="color: #000000;">Ask about timetable, exams, courses, or exam seating</p>
    </div>
    <div>
      <a href="/admin" class="bg-neutral-800 px-3 py-2 rounded" style="color: #fdfdfd;">Admin</a>
    </div>
  </header>

  <main class="w-full max-w-4xl">
    <div class="flex items-center gap-3 mb-4">
      <label class="text-gray-300" style="color:#000000"><b>Semester<b></label>
      <select id="semester" class="bg-neutral-900 text-white px-3 py-2 rounded">
        <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option>
        <option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option>
      </select>
      <button id="btn-timetable" class="ml-4 bg-blue-600 px-4 py-2 rounded">Timetable</button>
      <button id="btn-exams" class="bg-amber-600 px-3 py-2 rounded">Exams</button>
      <button id="btn-courses" class="bg-sky-600 px-3 py-2 rounded">Courses</button>
      <button id="btn-seating" class="bg-emerald-600 px-3 py-2 rounded">Seating</button>
    </div>

    <div id="output" class="panel p-4 min-h-[40vh]"></div>
  </main>

  <footer class="text-gray-500 mt-6">¬© 2025 SDMIT ADE</footer>

<script>
  const out = document.getElementById('output');
  const sem = document.getElementById('semester');

  function showHTML(html){ out.innerHTML = html; out.scrollTo({ top:0 }); }

  async function loadTimetable(){
    showHTML('<div class="text-gray-400">Loading timetable...</div>');
    const res = await fetch(`/api/timetable?semester=${encodeURIComponent(sem.value)}`);
    const rows = await res.json();
    if(!rows.length){ showHTML('<div class="text-gray-400">Your Personal Assistant</div>'); return; }

    // Group by day (rows already ordered by day, start_time)
    const grouped = {};
    for(const r of rows){
      if(!grouped[r.day]) grouped[r.day] = [];
      grouped[r.day].push(r);
    }

    let html = `<h2 class="text-lg font-semibold mb-3 flex items-center gap-2">üìÖ Timetable ‚Äî Semester ${sem.value}</h2>`;
    html += `<div class="rounded-lg overflow-hidden"><table class="w-full"><thead style="background-color:lightgreen;color:white;"><tr><th>Day</th><th>Time</th><th>Subject</th><th>Room</th></tr></thead><tbody>`;

    for(const day of Object.keys(grouped)){
      const items = grouped[day];
      // first row with day cell using rowspan
      for(let i=0;i<items.length;i++){
        const it = items[i];
        html += "<tr style='background-color:rgb(192,192,192);border:1px solid black;'>";
        if(i===0){
          html += `<td rowspan="${items.length}" style="vertical-align:top; padding:10px; font-weight:600;border:2px solid black;">${day}</td>`;
        }
        html += `<td style="padding:10px;border:1px solid black;">${it.time_range}</td>`;
        html += `<td style="padding:10px;border:1px solid black;">${it.subject}</td>`;
        html += `<td style="padding:10px;border:1px solid black;">${it.classroom}</td>`;
        html += "</tr>";
      }
    }

    html += `</tbody></table></div>`;
    showHTML(html);
  }

  async function loadExams(){
    showHTML('<div class="text-gray-400">Loading exams...</div>');
    const res = await fetch(`/api/exams?semester=${encodeURIComponent(sem.value)}`);
    const rows = await res.json();
    if(!rows.length){ showHTML('<div class="text-gray-400">No exams scheduled for this semester.</div>'); return; }
    let html = `<h2 class="text-lg font-semibold mb-3">üìù Exams ‚Äî Semester ${sem.value}</h2>`;
    html += `<table class="w-full"><thead><tr><th>Subject</th><th>Date</th><th>Time</th><th>Room</th></tr></thead><tbody>`;
    rows.forEach(r => {
      html += `<tr><td style="padding:10px">${r.subject}</td><td style="padding:10px">${r.date}</td><td style="padding:10px">${r.time}</td><td style="padding:10px">${r.classroom}</td></tr>`;
    });
    html += `</tbody></table>`;
    showHTML(html);
  }

  async function loadCourses(){
    showHTML('<div class="text-gray-400">Loading courses...</div>');
    const res = await fetch(`/api/courses?semester=${encodeURIComponent(sem.value)}`);
    const rows = await res.json();
    if(!rows.length){ showHTML('<div class="text-gray-400">No courses for this semester.</div>'); return; }
    let html = `<h2 class="text-lg font-semibold mb-3">üìö Courses ‚Äî Semester ${sem.value}</h2>`;
    html += `<table class="w-full"><thead><tr><th>Course</th><th>Duration</th><th>Fee</th></tr></thead><tbody>`;
    rows.forEach(r => {
      html += `<tr><td style="padding:10px">${r.course_name}</td><td style="padding:10px">${r.duration}</td><td style="padding:10px">${r.fee}</td></tr>`;
    });
    html += `</tbody></table>`;
    showHTML(html);
  }

  async function loadSeating(){
    showHTML('<div class="text-gray-400">Loading seating...</div>');
    const res = await fetch(`/api/seating?semester=${encodeURIComponent(sem.value)}`);
    const rows = await res.json();
    if(!rows.length){ showHTML('<div class="text-gray-400">No seating data for this semester.</div>'); return; }
    let html = `<h2 class="text-lg font-semibold mb-3">üí∫ Exam Seating ‚Äî Semester ${sem.value}</h2>`;
    html += `<table class="w-full"><thead><tr><th>Subject</th><th>Student</th><th>USN</th><th>Room</th><th>Seat</th></tr></thead><tbody>`;
    rows.forEach(r => {
      html += `<tr><td style="padding:10px">${r.subject}</td><td style="padding:10px">${r.student_name}</td><td style="padding:10px">${r.usn}</td><td style="padding:10px">${r.classroom}</td><td style="padding:10px">${r.seat_number}</td></tr>`;
    });
    html += `</tbody></table>`;
    showHTML(html);
  }

  document.getElementById('btn-timetable').addEventListener('click', loadTimetable);
  document.getElementById('btn-exams').addEventListener('click', loadExams);
  document.getElementById('btn-courses').addEventListener('click', loadCourses);
  document.getElementById('btn-seating').addEventListener('click', loadSeating);

  // initial load
  loadTimetable();
</script>
</body>
</html>
